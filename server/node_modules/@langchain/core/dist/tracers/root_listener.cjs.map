{"version":3,"file":"root_listener.cjs","names":["BaseTracer"],"sources":["../../src/tracers/root_listener.ts"],"sourcesContent":["import { RunnableConfig } from \"../runnables/config.js\";\nimport { BaseTracer, Run } from \"./base.js\";\n\nexport class RootListenersTracer extends BaseTracer {\n  name = \"RootListenersTracer\";\n\n  /** The Run's ID. Type UUID */\n  rootId?: string;\n\n  config: RunnableConfig;\n\n  argOnStart?: (run: Run, config: RunnableConfig) => void | Promise<void>;\n\n  argOnEnd?: (run: Run, config: RunnableConfig) => void | Promise<void>;\n\n  argOnError?: (run: Run, config: RunnableConfig) => void | Promise<void>;\n\n  constructor({\n    config,\n    onStart,\n    onEnd,\n    onError,\n  }: {\n    config: RunnableConfig;\n    onStart?: (run: Run, config: RunnableConfig) => void | Promise<void>;\n    onEnd?: (run: Run, config: RunnableConfig) => void | Promise<void>;\n    onError?: (run: Run, config: RunnableConfig) => void | Promise<void>;\n  }) {\n    super({ _awaitHandler: true });\n    this.config = config;\n    this.argOnStart = onStart;\n    this.argOnEnd = onEnd;\n    this.argOnError = onError;\n  }\n\n  /**\n   * This is a legacy method only called once for an entire run tree\n   * therefore not useful here\n   * @param {Run} _ Not used\n   */\n  persistRun(_: Run): Promise<void> {\n    return Promise.resolve();\n  }\n\n  async onRunCreate(run: Run) {\n    if (this.rootId) {\n      return;\n    }\n\n    this.rootId = run.id;\n\n    if (this.argOnStart) {\n      await this.argOnStart(run, this.config);\n    }\n  }\n\n  async onRunUpdate(run: Run) {\n    if (run.id !== this.rootId) {\n      return;\n    }\n    if (!run.error) {\n      if (this.argOnEnd) {\n        await this.argOnEnd(run, this.config);\n      }\n    } else if (this.argOnError) {\n      await this.argOnError(run, this.config);\n    }\n  }\n}\n"],"mappings":";;;AAGA,IAAa,sBAAb,cAAyCA,gCAAW;CAClD,OAAO;;CAGP;CAEA;CAEA;CAEA;CAEA;CAEA,YAAY,EACV,QACA,SACA,OACA,WAMC;AACD,QAAM,EAAE,eAAe,MAAM,CAAC;AAC9B,OAAK,SAAS;AACd,OAAK,aAAa;AAClB,OAAK,WAAW;AAChB,OAAK,aAAa;;;;;;;CAQpB,WAAW,GAAuB;AAChC,SAAO,QAAQ,SAAS;;CAG1B,MAAM,YAAY,KAAU;AAC1B,MAAI,KAAK,OACP;AAGF,OAAK,SAAS,IAAI;AAElB,MAAI,KAAK,WACP,OAAM,KAAK,WAAW,KAAK,KAAK,OAAO;;CAI3C,MAAM,YAAY,KAAU;AAC1B,MAAI,IAAI,OAAO,KAAK,OAClB;AAEF,MAAI,CAAC,IAAI,OACP;OAAI,KAAK,SACP,OAAM,KAAK,SAAS,KAAK,KAAK,OAAO;aAE9B,KAAK,WACd,OAAM,KAAK,WAAW,KAAK,KAAK,OAAO"}